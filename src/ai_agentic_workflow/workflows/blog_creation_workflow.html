<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Creation Workflow</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .workflow-step {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }
        .step-header {
            background: #e9ecef;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            border-radius: 8px 8px 0 0;
        }
        .step-content {
            padding: 20px;
        }
        .prompt-text {
            background: #fff;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .final-prompt {
            background: #e7f3ff;
            border: 2px solid #007bff;
        }
        .response-area {
            min-height: 200px;
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
        }
        .data-display {
            background: #f0fdf4;
            border: 1px solid #22c55e;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
        }
        .topic-details {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-size: 12px;
        }
        .step-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        .column-container {
            position: relative;
        }
        .step-completed {
            background: #d4edda !important;
            border-color: #c3e6cb !important;
        }
        .collapse-toggle {
            cursor: pointer;
            user-select: none;
        }
        .nav-pills .nav-link.active {
            background-color: #007bff;
        }
        .progress {
            height: 25px;
            margin-bottom: 20px;
        }
        .progress-bar {
            font-size: 14px;
            line-height: 25px;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center mb-4">
                    <i class="fas fa-blog"></i> Blog Creation Workflow
                </h1>
                
                <!-- Progress Bar -->
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 0%" id="progressBar">
                        Step 0 of 8
                    </div>
                </div>

                <!-- Step Navigation -->
                <ul class="nav nav-pills mb-4 justify-content-center" id="stepNavigation">
                    <li class="nav-item">
                        <a class="nav-link active" href="#step1" data-step="1">1. Profile Analysis</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step2" data-step="2">2. Trend Research</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step3" data-step="3">3. Story Architecture</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step4" data-step="4">4. Style Analysis</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step5" data-step="5">5. Blog Crafting</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step6" data-step="6">6. Blog Review</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step7" data-step="7">7. Enhancement</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#step8" data-step="8">8. Community</a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Step 1: Profile Analysis -->
        <div class="workflow-step" id="step1">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step1Content">
                    <span class="step-number">1</span>LinkedIn Profile Analysis
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse show" id="step1Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Analyze the following LinkedIn profile data to extract expertise and potential story narratives:
Profile Data:
https://www.linkedin.com/in/neerajkumarsinghb/
Your task:
1. Identify all technical skills and years of experience with each
2. Extract potential "story moments" from job transitions and projects
3. Find struggle-to-success narratives that could be used in blog posts
4. Map technologies to real scenarios from their career
5. Identify career progression patterns and learning moments
Focus on finding human stories behind the technical experience that would resonate with junior to mid-level developers.
OUTPUT FORMAT as JSON:
{{
    "technical_expertise": {{
        "technology_name": {{
            "years": X,
            "proficiency": "expert/intermediate/learning",
            "story_snippets": ["specific project or challenge", "another story"]
        }}
    }},
    "career_stories": [
        {{
            "type": "challenge/learning/mentoring/success",
            "summary": "brief story description",
            "technologies": ["tech1", "tech2"],
            "lesson": "what readers can learn"
        }}
    ],
    "writing_angles": ["angle1", "angle2"],
    "target_audience_alignment": "how experience matches junior/mid dev needs"
}}
IMPORTANT: Return ONLY the JSON object, no markdown formatting or additional text
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> LinkedIn Profile Input</h5>
                            <div class="alert alert-info">
                                <small><i class="fas fa-info-circle"></i> Provide either profile data OR LinkedIn URL (not both)</small>
                            </div>
                            
                            <div class="mb-3">
                                <label for="profileData" class="form-label">Option 1: Profile Data</label>
                                <textarea class="form-control" rows="8" id="profileData" placeholder="Paste LinkedIn profile information here..."></textarea>
                            </div>
                            
                            <div class="text-center my-2">
                                <strong>-- OR --</strong>
                            </div>
                            
                            <div class="mb-3">
                                <label for="profileUrl" class="form-label">Option 2: LinkedIn URL</label>
                                <input type="text" class="form-control" id="profileUrl" placeholder="https://linkedin.com/in/username">
                                <small class="text-muted">The AI will analyze the profile directly from the URL</small>
                            </div>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt1')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt1">
                                Click "Generate Prompt" to create the final prompt with your data.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(1)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response1" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(1)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Trend Research -->
        <div class="workflow-step" id="step2">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step2Content">
                    <span class="step-number">2</span>Tech Trend Research
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step2Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Research and identify 5-7 trending topics in technology that match the following expertise areas:

{expertise_areas}

For each topic, provide:

1. **Topic Details**:
   - Topic name and description
   - Why it's trending now
   - Current engagement levels
   - Target audience

2. **Alignment Score**:
   - Match with user expertise (1-10)
   - Teaching potential (1-10)
   - Audience interest (1-10)
   - Content gap opportunity (1-10)

3. **Content Angle**:
   - Unique perspective to take
   - Personal experience connection
   - Practical value proposition

Return as JSON:
{
  "trending_topics": [
    {
      "topic": "",
      "category": "",
      "engagement_score": 0,
      "difficulty_level": "",
      "teaching_potential": true/false,
      "content_angle": ""
    }
  ]
}
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> Additional Context</h5>
                            <div class="data-display" id="expertiseDisplay">
                                Expertise data will appear here after completing Step 1
                            </div>
                            <textarea class="form-control" rows="6" id="trendContext" placeholder="Add any additional context for trend research..."></textarea>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt2')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt2">
                                Complete Step 1 first, then generate prompt.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(2)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response2" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(2)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Story Architecture -->
        <div class="workflow-step" id="step3">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step3Content">
                    <span class="step-number">3</span>Story Architecture
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step3Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Create a compelling story blueprint that combines the selected topic with personal experience:

Selected Topic: {selected_topic}
Expertise Profile: {expertise_profile}
Available Stories: {story_bank}

Design a narrative structure with:

1. **Hook & Opening**:
   - Attention-grabbing opening
   - Personal anecdote or problem
   - Why this matters now

2. **Story Arc**:
   - The challenge or journey
   - Key learning moments
   - Technical insights gained
   - How it changed approach

3. **Technical Deep Dive**:
   - Core concepts to explain
   - Practical examples
   - Code snippets or demos
   - Best practices learned

4. **Resolution & Value**:
   - Lessons learned
   - Actionable takeaways
   - Future implications
   - Call to action

Return as JSON with detailed structure for each section.
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> Topic Selection & Context</h5>
                            <div class="data-display" id="topicSelection">
                                <label for="selectedTopic">Select Topic:</label>
                                <select class="form-select" id="selectedTopic">
                                    <option value="">Complete Step 2 first</option>
                                </select>
                            </div>
                            <div class="topic-details" id="selectedTopicDetails" style="display: none;">
                                <strong>Selected Topic Details:</strong>
                                <div id="topicDetailsContent"></div>
                            </div>
                            <div class="data-display" id="storyContext">
                                Expertise and stories will appear here after completing previous steps
                            </div>
                            <textarea class="form-control" rows="4" id="additionalStory" placeholder="Add any additional story context or specific experiences..."></textarea>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt3')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt3">
                                Complete previous steps first, then generate prompt.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(3)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response3" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(3)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 4: Style Analysis -->
        <div class="workflow-step" id="step4">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step4Content">
                    <span class="step-number">4</span>Writing Style Analysis
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step4Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Analyze the following LinkedIn posts to decode the unique writing style:

{linkedin_posts}

Extract and codify:

1. **Voice & Tone**:
   - Formal vs casual language
   - Technical vs accessible explanations
   - Emotional resonance level
   - Confidence and authority

2. **Structure Patterns**:
   - Post opening styles
   - Paragraph length preferences
   - Use of lists and formatting
   - Conclusion patterns

3. **Language Characteristics**:
   - Vocabulary complexity
   - Sentence structure
   - Use of metaphors/analogies
   - Technical jargon balance

4. **Engagement Style**:
   - Question usage
   - Call-to-action patterns
   - Community interaction approach
   - Personal disclosure level

Return comprehensive style guide as JSON.
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> LinkedIn Posts</h5>
                            <textarea class="form-control" rows="10" id="linkedinPosts" placeholder="Paste LinkedIn posts for style analysis..."></textarea>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt4')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt4">
                                Add LinkedIn posts, then generate prompt.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(4)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response4" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(4)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 5: Blog Crafting -->
        <div class="workflow-step" id="step5">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step5Content">
                    <span class="step-number">5</span>Blog Crafting
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step5Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Write a compelling technical blog post using:

Story Blueprint: {story_blueprint}
Style Guide: {style_guide}
Topic Details: {topic_details}

Create a complete blog post with:

1. **Engaging Title**: Hook readers immediately
2. **Strong Opening**: Personal story or compelling problem
3. **Technical Content**: Clear explanations with examples
4. **Personal Insights**: Unique perspectives and lessons
5. **Practical Value**: Actionable takeaways
6. **Strong Conclusion**: Memorable ending with CTA

Requirements:
- 1500-2500 words
- Use markdown formatting
- Include code examples where relevant
- Match the analyzed writing style
- Follow the story blueprint structure
- Make it authentic and engaging

Write the complete blog post in markdown format.
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> Combined Data</h5>
                            <div class="data-display" id="combinedData">
                                All previous step data will be combined here automatically
                            </div>
                            <textarea class="form-control" rows="4" id="additionalGuidance" placeholder="Any additional guidance for the blog writing..."></textarea>
                            
                            <!-- Debug Information -->
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-info" onclick="showDebugInfo(5)">
                                    <i class="fas fa-bug"></i> Debug Data
                                </button>
                                <button class="btn btn-sm btn-outline-warning" onclick="fixSelectedTopic()">
                                    <i class="fas fa-wrench"></i> Fix Topic
                                </button>
                            </div>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt5')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt5">
                                Complete previous steps first, then generate prompt.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(5)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response5" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(5)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 6: Blog Review -->
        <div class="workflow-step" id="step6">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step6Content">
                    <span class="step-number">6</span>Blog Review
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step6Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Review and score this blog post comprehensively:

Blog Content: {blog_content}
Author Profile: {profile_data}
Style Guide: {style_guide}

Evaluate on:

1. **Content Quality (25 points)**:
   - Technical accuracy
   - Depth of insights
   - Practical value
   - Unique perspective

2. **Engagement Factor (25 points)**:
   - Hook effectiveness
   - Story integration
   - Readability flow
   - Call-to-action strength

3. **Authenticity (25 points)**:
   - Voice consistency
   - Personal experience integration
   - Style guide adherence
   - Genuine insights

4. **Structure & Format (25 points)**:
   - Logical flow
   - Markdown formatting
   - Section organization
   - Visual appeal

Provide detailed feedback with specific improvement suggestions and an overall score out of 100.

Return as JSON with scores and detailed feedback.
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> Blog Content</h5>
                            <div class="data-display" id="blogContent">
                                Blog content from Step 5 will appear here
                            </div>
                            <textarea class="form-control" rows="4" id="reviewGuidance" placeholder="Any specific aspects to focus on during review..."></textarea>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt6')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt6">
                                Complete previous steps first, then generate prompt.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(6)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response6" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(6)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 7: Blog Enhancement -->
        <div class="workflow-step" id="step7">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step7Content">
                    <span class="step-number">7</span>Blog Enhancement
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step7Content">
                <div class="step-content">
                    <div class="alert alert-info" id="enhancementAlert">
                        <i class="fas fa-info-circle"></i> This step is only needed if the review score is below 85/100
                    </div>
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Enhance this blog post based on the detailed review feedback:

Original Blog: {blog_content}
Review Feedback: {review_feedback}
Style Guide: {style_guide}

Improvement Areas:
- Address all specific feedback points
- Strengthen weak sections identified
- Enhance engagement and authenticity
- Improve structure and flow
- Add missing elements

Guidelines:
- Maintain the original voice and style
- Keep the core story and structure
- Focus on targeted improvements
- Ensure technical accuracy
- Enhance practical value

Provide the complete enhanced blog post in markdown format.
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> Review Feedback</h5>
                            <div class="data-display" id="reviewFeedback">
                                Review feedback from Step 6 will appear here
                            </div>
                            <textarea class="form-control" rows="4" id="enhancementNotes" placeholder="Additional enhancement notes..."></textarea>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt7')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt7">
                                Enhancement prompt will be generated based on review score.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(7)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response7" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(7)">
                                <i class="fas fa-save"></i> Save & Next
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 8: Community Connection -->
        <div class="workflow-step" id="step8">
            <div class="step-header">
                <h3 class="collapse-toggle" data-bs-toggle="collapse" data-bs-target="#step8Content">
                    <span class="step-number">8</span>Community Connection
                    <i class="fas fa-chevron-down float-end"></i>
                </h3>
            </div>
            <div class="collapse" id="step8Content">
                <div class="step-content">
                    <div class="row">
                        <!-- Predefined Prompt -->
                        <div class="col-md-3">
                            <h5><i class="fas fa-file-text"></i> Predefined Prompt</h5>
                            <div class="prompt-text">
Enhance this blog post with community resources and connections:

Final Blog Content: {blog_content}
Topic: {topic}

Add the following sections to the blog:

1. **Related Resources**:
   - Documentation links
   - Tutorial resources
   - Tool recommendations
   - Official guides

2. **Community Connections**:
   - Relevant forums and communities
   - Notable experts to follow
   - Discord/Slack communities
   - Reddit communities

3. **Further Learning**:
   - Advanced topics to explore
   - Related skills to develop
   - Course recommendations
   - Books and articles

4. **Engagement Opportunities**:
   - Discussion questions
   - Project ideas
   - Contribution opportunities
   - Events and meetups

Return the enhanced blog with these sections added naturally.
                            </div>
                        </div>

                        <!-- Input Data -->
                        <div class="col-md-4">
                            <h5><i class="fas fa-edit"></i> Final Blog Content</h5>
                            <div class="data-display" id="finalBlogContent">
                                Final blog content will appear here
                            </div>
                            <textarea class="form-control" rows="4" id="communityNotes" placeholder="Specific communities or resources to mention..."></textarea>
                        </div>

                        <!-- Final Prompt -->
                        <div class="col-md-3 column-container">
                            <h5><i class="fas fa-copy"></i> Final Prompt</h5>
                            <button class="btn btn-sm btn-outline-primary copy-btn" onclick="copyToClipboard('finalPrompt8')">
                                <i class="fas fa-copy"></i>
                            </button>
                            <div class="prompt-text final-prompt" id="finalPrompt8">
                                Complete previous steps first, then generate prompt.
                            </div>
                            <button class="btn btn-primary mt-2" onclick="generateFinalPrompt(8)">
                                <i class="fas fa-magic"></i> Generate Prompt
                            </button>
                        </div>

                        <!-- Response -->
                        <div class="col-md-2">
                            <h5><i class="fas fa-robot"></i> AI Response</h5>
                            <textarea class="form-control response-area" id="response8" placeholder="Paste AI response here..."></textarea>
                            <button class="btn btn-success mt-2" onclick="saveStepData(8)">
                                <i class="fas fa-check"></i> Complete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Section -->
        <div class="workflow-step" id="summary" style="display: none;">
            <div class="step-header">
                <h3><i class="fas fa-flag-checkered"></i> Workflow Complete!</h3>
            </div>
            <div class="step-content">
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-success">
                            <h4><i class="fas fa-trophy"></i> Congratulations!</h4>
                            <p>Your blog creation workflow is complete. You can now download all your data or start a new workflow.</p>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-primary btn-lg me-3" onclick="downloadWorkflowData()">
                                <i class="fas fa-download"></i> Download All Data
                            </button>
                            <button class="btn btn-outline-secondary btn-lg" onclick="resetWorkflow()">
                                <i class="fas fa-refresh"></i> Start New Workflow
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Workflow data storage
        let workflowData = {
            profileData: '',
            expertiseProfile: null,
            trendingTopics: null,
            selectedTopic: null,
            storyBlueprint: null,
            styleGuide: null,
            blogDraft: '',
            reviewFeedback: null,
            enhancedBlog: '',
            finalBlog: '',
            communityResources: null,
            currentStep: 1,
            completedSteps: []
        };

        // Load saved data on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('\n🚀 Blog Workflow Interface Loading...');
            console.log('⏰ Timestamp:', new Date().toISOString());
            
            loadWorkflowData();
            updateProgress();
            setupEventListeners();
            
            console.log('✅ Interface loaded successfully');
            console.log('📊 Initial workflow state:', {
                completedSteps: workflowData.completedSteps,
                currentStep: workflowData.currentStep,
                hasExpertiseProfile: !!workflowData.expertiseProfile,
                hasTrendingTopics: !!workflowData.trendingTopics,
                trendingTopicsCount: workflowData.trendingTopics ? workflowData.trendingTopics.length : 0,
                hasSelectedTopic: !!workflowData.selectedTopic,
                hasStoryBlueprint: !!workflowData.storyBlueprint,
                hasStyleGuide: !!workflowData.styleGuide
            });
        });

        function setupEventListeners() {
            // Step navigation
            document.querySelectorAll('[data-step]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const step = parseInt(this.dataset.step);
                    navigateToStep(step);
                });
            });

            // Auto-save inputs
            document.querySelectorAll('textarea, input, select').forEach(input => {
                input.addEventListener('change', saveCurrentInputs);
            });
        }

        function saveCurrentInputs() {
            // Save current input values
            const inputs = {
                profileData: document.getElementById('profileData')?.value || '',
                profileUrl: document.getElementById('profileUrl')?.value || '',
                trendContext: document.getElementById('trendContext')?.value || '',
                selectedTopic: document.getElementById('selectedTopic')?.value || '',
                additionalStory: document.getElementById('additionalStory')?.value || '',
                linkedinPosts: document.getElementById('linkedinPosts')?.value || '',
                additionalGuidance: document.getElementById('additionalGuidance')?.value || '',
                reviewGuidance: document.getElementById('reviewGuidance')?.value || '',
                enhancementNotes: document.getElementById('enhancementNotes')?.value || '',
                communityNotes: document.getElementById('communityNotes')?.value || ''
            };
            
            Object.assign(workflowData, inputs);
            localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
        }

        function loadWorkflowData() {
            const saved = localStorage.getItem('blogWorkflowData');
            if (saved) {
                workflowData = { ...workflowData, ...JSON.parse(saved) };
                
                // Restore input values
                Object.keys(workflowData).forEach(key => {
                    const element = document.getElementById(key);
                    if (element && workflowData[key]) {
                        element.value = workflowData[key];
                    }
                });

                // Update displays
                updateDataDisplays();
                updateTopicSelection();
            }
        }

        function generateFinalPrompt(step) {
            const prompts = {
                1: generateProfilePrompt,
                2: generateTrendPrompt,
                3: generateStoryPrompt,
                4: generateStylePrompt,
                5: generateBlogPrompt,
                6: generateReviewPrompt,
                7: generateEnhancementPrompt,
                8: generateCommunityPrompt
            };

            if (prompts[step]) {
                prompts[step]();
            }
        }

        function generateProfilePrompt() {
            const profileData = document.getElementById('profileData').value.trim();
            const profileUrl = document.getElementById('profileUrl').value.trim();
            const basePrompt = document.querySelector('#step1 .prompt-text').textContent;
            
            // Check that either profile data or URL is provided, but not both
            if (!profileData && !profileUrl) {
                alert('Please provide either LinkedIn profile data or a LinkedIn URL.');
                return;
            }
            
            if (profileData && profileUrl) {
                alert('Please provide either profile data OR LinkedIn URL, not both.');
                return;
            }
            
            // Use whichever input is provided and replace the example URL
            const profileInput = profileData || profileUrl;
            const finalPrompt = basePrompt.replace('https://www.linkedin.com/in/neerajkumarsinghb/', profileInput);
            
            document.getElementById('finalPrompt1').textContent = finalPrompt;
        }

        function generateTrendPrompt() {
            if (!workflowData.expertiseProfile) {
                alert('Please complete Step 1 first.');
                return;
            }

            const basePrompt = document.querySelector('#step2 .prompt-text').textContent;
            const expertiseAreas = JSON.stringify(workflowData.expertiseProfile.technical_expertise || {});
            const additionalContext = document.getElementById('trendContext').value;
            
            let finalPrompt = basePrompt.replace('{expertise_areas}', expertiseAreas);
            
            if (additionalContext.trim()) {
                finalPrompt += '\n\n=== ADDITIONAL CONTEXT ===\n' + additionalContext;
            }

            document.getElementById('finalPrompt2').textContent = finalPrompt;
        }

        function generateStoryPrompt() {
            if (!workflowData.selectedTopic || !workflowData.expertiseProfile) {
                alert('Please complete previous steps first.');
                return;
            }

            const basePrompt = document.querySelector('#step3 .prompt-text').textContent;
            const additionalStory = document.getElementById('additionalStory').value;
            
            let finalPrompt = basePrompt
                .replace('{selected_topic}', JSON.stringify(workflowData.selectedTopic))
                .replace('{expertise_profile}', JSON.stringify(workflowData.expertiseProfile))
                .replace('{story_bank}', JSON.stringify(workflowData.expertiseProfile.career_stories || []));
            
            if (additionalStory.trim()) {
                finalPrompt += '\n\n=== ADDITIONAL STORY CONTEXT ===\n' + additionalStory;
            }

            document.getElementById('finalPrompt3').textContent = finalPrompt;
        }

        function generateStylePrompt() {
            const linkedinPosts = document.getElementById('linkedinPosts').value;
            const basePrompt = document.querySelector('#step4 .prompt-text').textContent;
            
            if (!linkedinPosts.trim()) {
                alert('Please enter LinkedIn posts for analysis.');
                return;
            }

            const finalPrompt = basePrompt.replace('{linkedin_posts}', linkedinPosts);
            document.getElementById('finalPrompt4').textContent = finalPrompt;
        }

        function generateBlogPrompt() {
            console.log('\n📝 Generating blog crafting prompt...');
            
            // FIRST: Check if selectedTopic is corrupted and try auto-fix
            console.log('🔍 Pre-validation check - selectedTopic type:', typeof workflowData.selectedTopic);
            console.log('🔍 Pre-validation check - selectedTopic value:', workflowData.selectedTopic);
            
            if ((!workflowData.selectedTopic || typeof workflowData.selectedTopic !== 'object') && workflowData.trendingTopics) {
                console.log('🔧 Attempting auto-fix for selectedTopic...');
                
                // Try to get from dropdown
                const select = document.getElementById('selectedTopic');
                const dropdownValue = select ? select.value : '';
                
                if (dropdownValue !== '' && workflowData.trendingTopics[dropdownValue]) {
                    console.log('🔧 Auto-fixing from dropdown value:', dropdownValue);
                    workflowData.selectedTopic = workflowData.trendingTopics[dropdownValue];
                    displaySelectedTopicDetails(workflowData.selectedTopic);
                    localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                    console.log('✅ Auto-fixed selectedTopic:', workflowData.selectedTopic);
                } else if (workflowData.selectedTopicIndex && workflowData.trendingTopics[workflowData.selectedTopicIndex]) {
                    console.log('🔧 Auto-fixing from saved index:', workflowData.selectedTopicIndex);
                    workflowData.selectedTopic = workflowData.trendingTopics[workflowData.selectedTopicIndex];
                    if (select) select.value = workflowData.selectedTopicIndex;
                    displaySelectedTopicDetails(workflowData.selectedTopic);
                    localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                    console.log('✅ Auto-fixed selectedTopic:', workflowData.selectedTopic);
                } else {
                    // Try to find Platform Engineering topic
                    const platformTopic = workflowData.trendingTopics.find(t => 
                        t.topic && t.topic.includes('Platform Engineering')
                    );
                    if (platformTopic) {
                        console.log('🔧 Auto-selecting Platform Engineering topic');
                        workflowData.selectedTopic = platformTopic;
                        const topicIndex = workflowData.trendingTopics.indexOf(platformTopic);
                        if (select) select.value = topicIndex;
                        displaySelectedTopicDetails(platformTopic);
                        localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                        console.log('✅ Auto-selected Platform Engineering:', platformTopic);
                    }
                }
            }
            
            // Log current workflow data state
            console.log('📊 Current workflow data state:');
            console.log('  - Story Blueprint exists:', !!workflowData.storyBlueprint);
            console.log('  - Story Blueprint keys:', workflowData.storyBlueprint ? Object.keys(workflowData.storyBlueprint) : 'N/A');
            console.log('  - Style Guide exists:', !!workflowData.styleGuide);
            console.log('  - Style Guide keys:', workflowData.styleGuide ? Object.keys(workflowData.styleGuide) : 'N/A');
            console.log('  - Selected Topic exists:', !!workflowData.selectedTopic);
            console.log('  - Selected Topic type:', typeof workflowData.selectedTopic);
            console.log('  - Selected Topic data:', workflowData.selectedTopic);
            console.log('  - Trending Topics exists:', !!workflowData.trendingTopics);
            console.log('  - Trending Topics count:', workflowData.trendingTopics ? workflowData.trendingTopics.length : 0);
            console.log('  - Completed Steps:', workflowData.completedSteps);

            // More flexible validation - check if we have the essential data
            const hasStoryBlueprint = workflowData.storyBlueprint && 
                (workflowData.storyBlueprint.story_blueprint || workflowData.storyBlueprint.hook_opening || workflowData.storyBlueprint);
            const hasStyleGuide = workflowData.styleGuide && 
                (workflowData.styleGuide.voice_and_tone || workflowData.styleGuide.author_profile || workflowData.styleGuide);
            const hasSelectedTopic = workflowData.selectedTopic && 
                typeof workflowData.selectedTopic === 'object' && 
                workflowData.selectedTopic.topic;

            console.log('🔍 Validation results:');
            console.log('  - Has Story Blueprint:', hasStoryBlueprint);
            console.log('  - Has Style Guide:', hasStyleGuide);
            console.log('  - Has Selected Topic:', hasSelectedTopic);

            if (!hasStoryBlueprint) {
                console.log('❌ Missing Story Blueprint - showing alert');
                alert('Please complete Step 3 (Story Architecture) first.');
                return;
            }
            
            if (!hasStyleGuide) {
                console.log('❌ Missing Style Guide - showing alert');
                alert('Please complete Step 4 (Style Analysis) first.');
                return;
            }
            
            if (!hasSelectedTopic) {
                console.log('❌ Missing Selected Topic - showing alert');
                console.log('  - Current selectedTopic value:', workflowData.selectedTopic);
                console.log('  - Current selectedTopic type:', typeof workflowData.selectedTopic);
                console.log('  - Available trending topics:', workflowData.trendingTopics);
                console.log('  - Dropdown value:', document.getElementById('selectedTopic')?.value);
                
                alert('❌ Topic selection is corrupted or missing.\n\n🔧 Try clicking the "Fix Topic" button, or go to Step 3 and re-select your topic from the dropdown.');
                return;
            }

            console.log('✅ All validations passed, generating prompt...');

            const basePrompt = document.querySelector('#step5 .prompt-text').textContent;
            const additionalGuidance = document.getElementById('additionalGuidance').value;
            
            // Handle nested story blueprint structure
            const storyBlueprintData = workflowData.storyBlueprint.story_blueprint || workflowData.storyBlueprint;
            const styleGuideData = workflowData.styleGuide;
            const topicData = workflowData.selectedTopic;
            
            console.log('🔧 Preparing data for prompt replacement...');
            console.log('  - Story Blueprint data keys:', Object.keys(storyBlueprintData));
            console.log('  - Style Guide data keys:', Object.keys(styleGuideData));
            console.log('  - Topic data keys:', Object.keys(topicData));
            
            let finalPrompt = basePrompt
                .replace('{story_blueprint}', JSON.stringify(storyBlueprintData, null, 2))
                .replace('{style_guide}', JSON.stringify(styleGuideData, null, 2))
                .replace('{topic_details}', JSON.stringify(topicData, null, 2));
            
            if (additionalGuidance.trim()) {
                finalPrompt += '\n\n=== ADDITIONAL GUIDANCE ===\n' + additionalGuidance;
                console.log('📝 Added additional guidance to prompt');
            }

            document.getElementById('finalPrompt5').textContent = finalPrompt;
            console.log('✅ Blog crafting prompt generated successfully');
            console.log('📏 Final prompt length:', finalPrompt.length);
        }

        function generateReviewPrompt() {
            if (!workflowData.blogDraft) {
                alert('Please complete Step 5 first.');
                return;
            }

            const basePrompt = document.querySelector('#step6 .prompt-text').textContent;
            const reviewGuidance = document.getElementById('reviewGuidance').value;
            
            let finalPrompt = basePrompt
                .replace('{blog_content}', workflowData.blogDraft)
                .replace('{profile_data}', workflowData.profileData)
                .replace('{style_guide}', JSON.stringify(workflowData.styleGuide || {}));
            
            if (reviewGuidance.trim()) {
                finalPrompt += '\n\n=== REVIEW FOCUS ===\n' + reviewGuidance;
            }

            document.getElementById('finalPrompt6').textContent = finalPrompt;
        }

        function generateEnhancementPrompt() {
            if (!workflowData.reviewFeedback) {
                alert('Please complete Step 6 first.');
                return;
            }

            const score = workflowData.reviewFeedback.overall_score || 0;
            if (score >= 85) {
                document.getElementById('finalPrompt7').textContent = 'Enhancement not needed - review score is 85+ points.';
                return;
            }

            const basePrompt = document.querySelector('#step7 .prompt-text').textContent;
            const enhancementNotes = document.getElementById('enhancementNotes').value;
            
            let finalPrompt = basePrompt
                .replace('{blog_content}', workflowData.blogDraft)
                .replace('{review_feedback}', JSON.stringify(workflowData.reviewFeedback))
                .replace('{style_guide}', JSON.stringify(workflowData.styleGuide || {}));
            
            if (enhancementNotes.trim()) {
                finalPrompt += '\n\n=== ENHANCEMENT NOTES ===\n' + enhancementNotes;
            }

            document.getElementById('finalPrompt7').textContent = finalPrompt;
        }

        function generateCommunityPrompt() {
            const currentBlog = workflowData.enhancedBlog || workflowData.blogDraft;
            if (!currentBlog) {
                alert('Please complete previous steps first.');
                return;
            }

            const basePrompt = document.querySelector('#step8 .prompt-text').textContent;
            const communityNotes = document.getElementById('communityNotes').value;
            
            let finalPrompt = basePrompt
                .replace('{blog_content}', currentBlog)
                .replace('{topic}', JSON.stringify(workflowData.selectedTopic || {}));
            
            if (communityNotes.trim()) {
                finalPrompt += '\n\n=== COMMUNITY NOTES ===\n' + communityNotes;
            }

            document.getElementById('finalPrompt8').textContent = finalPrompt;
        }

        function parseJsonResponse(response) {
            console.log('🔍 Parsing JSON response:', response.substring(0, 200) + '...');
            try {
                // First, try direct JSON parsing
                const result = JSON.parse(response);
                console.log('✅ Direct JSON parse successful:', result);
                return result;
            } catch (e) {
                console.log('❌ Direct JSON parse failed, trying cleanup:', e.message);
                try {
                    // Clean up common formatting issues
                    let cleaned = response.trim();
                    
                    // Remove markdown code blocks
                    cleaned = cleaned.replace(/```json\s*/g, '');
                    cleaned = cleaned.replace(/```\s*$/g, '');
                    
                    // Try to extract JSON object from the text
                    const jsonMatch = cleaned.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const result = JSON.parse(jsonMatch[0]);
                        console.log('✅ JSON extraction successful:', result);
                        return result;
                    }
                    
                    // If no JSON object found, try the cleaned text
                    const result = JSON.parse(cleaned);
                    console.log('✅ Cleaned JSON parse successful:', result);
                    return result;
                } catch (e2) {
                    console.error('❌ All JSON parsing attempts failed:', e2);
                    console.log('Raw response:', response);
                    throw new Error('Invalid JSON format');
                }
            }
        }

        function saveStepData(step) {
            console.log(`\n🚀 Starting to save data for Step ${step}`);
            const responseId = `response${step}`;
            const response = document.getElementById(responseId).value;
            
            if (!response.trim()) {
                alert('Please enter the AI response before saving.');
                return;
            }

            console.log(`📝 Raw response for Step ${step}:`, response.substring(0, 300) + '...');

            // For step 1, also save the profile input
            if (step === 1) {
                const profileData = document.getElementById('profileData').value.trim();
                const profileUrl = document.getElementById('profileUrl').value.trim();
                workflowData.profileData = profileData || profileUrl;
                console.log('👤 Saved profile data:', workflowData.profileData);
            }

            // Parse and save step-specific data
            try {
                switch(step) {
                    case 1:
                        workflowData.expertiseProfile = parseJsonResponse(response);
                        console.log('💼 Saved expertise profile:', workflowData.expertiseProfile);
                        break;
                    case 2:
                        const trendData = parseJsonResponse(response);
                        console.log('📊 Parsed trend data:', trendData);
                        workflowData.trendingTopics = trendData.trending_topics || [];
                        console.log('📈 Saved trending topics:', workflowData.trendingTopics);
                        console.log('📈 Number of trending topics:', workflowData.trendingTopics.length);
                        break;
                    case 3:
                        workflowData.storyBlueprint = parseJsonResponse(response);
                        console.log('📖 Saved story blueprint:', workflowData.storyBlueprint);
                        break;
                    case 4:
                        workflowData.styleGuide = parseJsonResponse(response);
                        console.log('🎨 Saved style guide:', workflowData.styleGuide);
                        break;
                    case 5:
                        workflowData.blogDraft = response;
                        console.log('📝 Saved blog draft (length):', response.length);
                        break;
                    case 6:
                        workflowData.reviewFeedback = parseJsonResponse(response);
                        console.log('🔍 Saved review feedback:', workflowData.reviewFeedback);
                        break;
                    case 7:
                        workflowData.enhancedBlog = response;
                        console.log('✨ Saved enhanced blog (length):', response.length);
                        break;
                    case 8:
                        workflowData.finalBlog = response;
                        console.log('🏁 Saved final blog (length):', response.length);
                        break;
                }
            } catch (e) {
                console.error(`❌ Error parsing Step ${step} data:`, e);
                if (step === 5 || step === 7 || step === 8) {
                    // These steps return text, not JSON
                    switch(step) {
                        case 5: workflowData.blogDraft = response; break;
                        case 7: workflowData.enhancedBlog = response; break;
                        case 8: workflowData.finalBlog = response; break;
                    }
                    console.log(`✅ Saved Step ${step} as text instead`);
                } else {
                    alert(`JSON parsing failed for step ${step}. Please ensure the response is valid JSON format.\n\nError: ${e.message}\n\nTip: Make sure there are no extra characters before or after the JSON object.`);
                    return;
                }
            }

            // Mark step as completed
            if (!workflowData.completedSteps.includes(step)) {
                workflowData.completedSteps.push(step);
                console.log(`✅ Marked step ${step} as completed`);
            }

            // Update current step
            workflowData.currentStep = Math.max(workflowData.currentStep, step + 1);
            console.log(`📈 Updated current step to: ${workflowData.currentStep}`);

            // Save to localStorage
            saveCurrentInputs();

            // Update UI
            markStepCompleted(step);
            updateDataDisplays();
            updateProgress();

            console.log(`🎉 Step ${step} completed successfully!`);
            console.log('📊 Current workflow state:', {
                completedSteps: workflowData.completedSteps,
                currentStep: workflowData.currentStep,
                hasExpertiseProfile: !!workflowData.expertiseProfile,
                hasTrendingTopics: !!workflowData.trendingTopics,
                hasSelectedTopic: !!workflowData.selectedTopic,
                hasStoryBlueprint: !!workflowData.storyBlueprint,
                hasStyleGuide: !!workflowData.styleGuide
            });

            // Navigate to next step
            if (step < 8) {
                navigateToStep(step + 1);
            } else {
                showSummary();
            }
        }

        function markStepCompleted(step) {
            const stepElement = document.getElementById(`step${step}`);
            stepElement.classList.add('step-completed');
            
            const navLink = document.querySelector(`[data-step="${step}"]`);
            navLink.innerHTML += ' <i class="fas fa-check text-success"></i>';
        }

        function updateDataDisplays() {
            // Update expertise display
            if (workflowData.expertiseProfile) {
                document.getElementById('expertiseDisplay').innerHTML = 
                    '<strong>Technical Expertise:</strong><br>' + 
                    JSON.stringify(workflowData.expertiseProfile.technical_expertise || {}, null, 2);
            }

            // Update story context
            if (workflowData.expertiseProfile) {
                document.getElementById('storyContext').innerHTML = 
                    '<strong>Career Stories:</strong><br>' + 
                    JSON.stringify(workflowData.expertiseProfile.career_stories || [], null, 2);
            }

            // Update combined data for blog crafting
            if (workflowData.storyBlueprint && workflowData.styleGuide) {
                const storyBlueprintData = workflowData.storyBlueprint.story_blueprint || workflowData.storyBlueprint;
                const styleGuideData = workflowData.styleGuide;
                
                document.getElementById('combinedData').innerHTML = 
                    '<strong>Story Blueprint:</strong><br>' + JSON.stringify(storyBlueprintData, null, 2).substring(0, 500) + '...' +
                    '<br><br><strong>Style Guide:</strong><br>' + JSON.stringify(styleGuideData, null, 2).substring(0, 500) + '...';
            }

            // Update blog content for review
            if (workflowData.blogDraft) {
                document.getElementById('blogContent').innerHTML = 
                    '<strong>Blog Draft:</strong><br>' + workflowData.blogDraft.substring(0, 500) + '...';
            }

            // Update review feedback
            if (workflowData.reviewFeedback) {
                document.getElementById('reviewFeedback').innerHTML = 
                    '<strong>Review Score:</strong> ' + (workflowData.reviewFeedback.overall_score || 0) + '/100<br>' +
                    '<strong>Feedback:</strong><br>' + JSON.stringify(workflowData.reviewFeedback, null, 2);
            }

            // Update final blog content
            const finalContent = workflowData.enhancedBlog || workflowData.blogDraft;
            if (finalContent) {
                document.getElementById('finalBlogContent').innerHTML = 
                    '<strong>Final Blog:</strong><br>' + finalContent.substring(0, 500) + '...';
            }

            // Update topic selection and details
            updateTopicSelection();
        }

        function updateTopicSelection() {
            console.log('\n🎯 Updating topic selection...');
            console.log('📊 Trending topics data:', workflowData.trendingTopics);
            
            const select = document.getElementById('selectedTopic');
            if (workflowData.trendingTopics && workflowData.trendingTopics.length > 0) {
                console.log(`📋 Found ${workflowData.trendingTopics.length} trending topics`);
                select.innerHTML = '<option value="">Select a topic...</option>';
                workflowData.trendingTopics.forEach((topic, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    // Use the actual topic name, fallback to a default if not available
                    const topicName = topic.topic || topic.title || topic.name || `Topic ${index + 1}`;
                    option.textContent = topicName;
                    select.appendChild(option);
                    console.log(`➕ Added topic ${index}: ${topicName}`);
                });

                // Remove any existing event listeners to avoid duplicates
                select.removeEventListener('change', handleTopicChange);
                // Add event listener for topic selection changes
                select.addEventListener('change', handleTopicChange);
                
                // If there's already a selected topic, try to find and select it
                if (workflowData.selectedTopic && typeof workflowData.selectedTopic === 'object') {
                    console.log('🔍 Checking for existing selected topic:', workflowData.selectedTopic);
                    
                    // Try to find the topic by matching the topic name or other unique properties
                    const selectedIndex = workflowData.trendingTopics.findIndex(t => {
                        // Match by topic name (most reliable)
                        if (t.topic && workflowData.selectedTopic.topic) {
                            return t.topic === workflowData.selectedTopic.topic;
                        }
                        // Fallback to full object comparison
                        return JSON.stringify(t) === JSON.stringify(workflowData.selectedTopic);
                    });
                    
                    console.log('📍 Found selected topic at index:', selectedIndex);
                    if (selectedIndex !== -1) {
                        select.value = selectedIndex;
                        displaySelectedTopicDetails(workflowData.selectedTopic);
                        console.log('✅ Restored topic selection from saved data');
                    } else {
                        console.log('⚠️ Could not find matching topic in trending topics list');
                    }
                } else if (workflowData.selectedTopicIndex) {
                    // Fallback: restore from saved index
                    console.log('📍 Restoring topic from saved index:', workflowData.selectedTopicIndex);
                    select.value = workflowData.selectedTopicIndex;
                    if (workflowData.trendingTopics[workflowData.selectedTopicIndex]) {
                        workflowData.selectedTopic = workflowData.trendingTopics[workflowData.selectedTopicIndex];
                        displaySelectedTopicDetails(workflowData.selectedTopic);
                    }
                }
            } else {
                console.log('❌ No trending topics data available');
            }
        }

        function handleTopicChange() {
            console.log('\n🔄 Topic selection changed');
            const select = document.getElementById('selectedTopic');
            console.log('📝 Selected value:', select.value);
            
            if (select.value !== '') {
                const selectedIndex = parseInt(select.value);
                const selectedTopic = workflowData.trendingTopics[selectedIndex];
                console.log('✅ Selected topic data:', selectedTopic);
                
                // Store the actual topic object, not the index
                workflowData.selectedTopic = selectedTopic;
                
                displaySelectedTopicDetails(selectedTopic);
                
                // Save manually with explicit preservation
                console.log('💾 Saving with explicit selectedTopic preservation...');
                const currentTopic = workflowData.selectedTopic;
                
                // Save other inputs but protect selectedTopic
                const inputs = {
                    profileData: document.getElementById('profileData')?.value || '',
                    profileUrl: document.getElementById('profileUrl')?.value || '',
                    trendContext: document.getElementById('trendContext')?.value || '',
                    additionalStory: document.getElementById('additionalStory')?.value || '',
                    linkedinPosts: document.getElementById('linkedinPosts')?.value || '',
                    additionalGuidance: document.getElementById('additionalGuidance')?.value || '',
                    reviewGuidance: document.getElementById('reviewGuidance')?.value || '',
                    enhancementNotes: document.getElementById('enhancementNotes')?.value || '',
                    communityNotes: document.getElementById('communityNotes')?.value || '',
                    selectedTopicIndex: selectedIndex
                };
                
                Object.assign(workflowData, inputs);
                
                // Force restore selectedTopic
                workflowData.selectedTopic = currentTopic;
                
                localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                
                console.log('💾 Saved selected topic to workflow data');
                
                // Verify it was saved correctly
                console.log('🔍 Verification - workflowData.selectedTopic:', workflowData.selectedTopic);
                console.log('🔍 Verification - typeof selectedTopic:', typeof workflowData.selectedTopic);
                console.log('🔍 Verification - selectedTopic exists:', !!workflowData.selectedTopic);
                console.log('🔍 Verification - has topic property:', !!(workflowData.selectedTopic && workflowData.selectedTopic.topic));
            } else {
                console.log('❌ No topic selected (empty value)');
                // Hide topic details if no topic selected
                document.getElementById('selectedTopicDetails').style.display = 'none';
                workflowData.selectedTopic = null;
                saveCurrentInputs();
            }
        }

        function displaySelectedTopicDetails(topic) {
            const detailsContainer = document.getElementById('selectedTopicDetails');
            const detailsContent = document.getElementById('topicDetailsContent');
            
            if (topic) {
                const formatScore = (score) => score ? `${score}/10` : 'N/A';
                
                const detailsHTML = `
                    <div style="font-size: 12px; margin-top: 10px;">
                        <div><strong>Topic:</strong> ${topic.topic || 'N/A'}</div>
                        <div><strong>Category:</strong> ${topic.category || 'N/A'}</div>
                        <div><strong>Description:</strong> ${topic.description || 'N/A'}</div>
                        <div><strong>Engagement Score:</strong> ${formatScore(topic.engagement_score)}</div>
                        <div><strong>Difficulty Level:</strong> ${topic.difficulty_level || 'N/A'}</div>
                        <div><strong>Teaching Potential:</strong> ${topic.teaching_potential ? 'Yes' : 'No'}</div>
                        <div><strong>Content Angle:</strong> ${topic.content_angle || 'N/A'}</div>
                        ${topic.why_trending ? `<div><strong>Why Trending:</strong> ${topic.why_trending}</div>` : ''}
                        ${topic.target_audience ? `<div><strong>Target Audience:</strong> ${topic.target_audience}</div>` : ''}
                    </div>
                `;
                
                detailsContent.innerHTML = detailsHTML;
                detailsContainer.style.display = 'block';
            } else {
                detailsContainer.style.display = 'none';
            }
        }

        function navigateToStep(step) {
            // Hide all steps
            document.querySelectorAll('.workflow-step').forEach(el => {
                el.style.display = 'none';
            });

            // Show target step
            document.getElementById(`step${step}`).style.display = 'block';

            // Update navigation
            document.querySelectorAll('[data-step]').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-step="${step}"]`).classList.add('active');

            // Expand the step content
            const targetCollapse = document.getElementById(`step${step}Content`);
            if (targetCollapse) {
                new bootstrap.Collapse(targetCollapse, { show: true });
            }

            workflowData.currentStep = step;
            updateProgress();
        }

        function updateProgress() {
            const completed = workflowData.completedSteps.length;
            const percentage = (completed / 8) * 100;
            const progressBar = document.getElementById('progressBar');
            
            progressBar.style.width = percentage + '%';
            progressBar.textContent = `Step ${completed} of 8 (${Math.round(percentage)}%)`;
            
            if (completed === 8) {
                progressBar.classList.remove('bg-primary');
                progressBar.classList.add('bg-success');
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary success message
                const btn = element.parentElement.querySelector('.copy-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i>';
                btn.classList.remove('btn-outline-primary');
                btn.classList.add('btn-success');
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-primary');
                }, 2000);
            });
        }

        function showSummary() {
            document.querySelectorAll('.workflow-step').forEach(el => {
                el.style.display = 'none';
            });
            document.getElementById('summary').style.display = 'block';
        }

        function downloadWorkflowData() {
            const dataStr = JSON.stringify(workflowData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'blog-workflow-data.json';
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function showDebugInfo(step) {
            console.log(`\n🐛 ===== DEBUG INFO FOR STEP ${step} =====`);
            
            const debugData = {
                currentStep: workflowData.currentStep,
                completedSteps: workflowData.completedSteps,
                
                // Step 1 data
                expertiseProfile: {
                    exists: !!workflowData.expertiseProfile,
                    keys: workflowData.expertiseProfile ? Object.keys(workflowData.expertiseProfile) : null,
                    data: workflowData.expertiseProfile
                },
                
                // Step 2 data
                trendingTopics: {
                    exists: !!workflowData.trendingTopics,
                    count: workflowData.trendingTopics ? workflowData.trendingTopics.length : 0,
                    data: workflowData.trendingTopics
                },
                
                // Selected topic
                selectedTopic: {
                    exists: !!workflowData.selectedTopic,
                    type: typeof workflowData.selectedTopic,
                    isObject: workflowData.selectedTopic && typeof workflowData.selectedTopic === 'object',
                    topicName: workflowData.selectedTopic && workflowData.selectedTopic.topic ? workflowData.selectedTopic.topic : 'N/A',
                    data: workflowData.selectedTopic
                },
                
                // Step 3 data
                storyBlueprint: {
                    exists: !!workflowData.storyBlueprint,
                    keys: workflowData.storyBlueprint ? Object.keys(workflowData.storyBlueprint) : null,
                    hasNestedBlueprint: !!(workflowData.storyBlueprint && workflowData.storyBlueprint.story_blueprint),
                    data: workflowData.storyBlueprint
                },
                
                // Step 4 data
                styleGuide: {
                    exists: !!workflowData.styleGuide,
                    keys: workflowData.styleGuide ? Object.keys(workflowData.styleGuide) : null,
                    data: workflowData.styleGuide
                },
                
                // Current UI state
                uiState: {
                    selectedTopicDropdownValue: document.getElementById('selectedTopic')?.value || '',
                    selectedTopicDropdownText: document.getElementById('selectedTopic')?.selectedOptions[0]?.text || ''
                },
                
                // Full workflow data
                fullWorkflowData: workflowData
            };
            
            // Print to console for easy copying
            console.log('📊 Debug Data Object:', debugData);
            console.log('📋 Full Workflow Data (for copying):', JSON.stringify(workflowData, null, 2));
            
            // Also show in alert for quick overview
            let debugInfo = `=== DEBUG INFO FOR STEP ${step} ===\n\n`;
            
            debugInfo += `Story Blueprint exists: ${debugData.storyBlueprint.exists}\n`;
            debugInfo += `Story Blueprint structure: ${debugData.storyBlueprint.keys ? debugData.storyBlueprint.keys.join(', ') : 'N/A'}\n`;
            debugInfo += `Has nested blueprint: ${debugData.storyBlueprint.hasNestedBlueprint}\n\n`;
            
            debugInfo += `Style Guide exists: ${debugData.styleGuide.exists}\n`;
            debugInfo += `Style Guide structure: ${debugData.styleGuide.keys ? debugData.styleGuide.keys.join(', ') : 'N/A'}\n\n`;
            
            debugInfo += `Selected Topic exists: ${debugData.selectedTopic.exists}\n`;
            debugInfo += `Selected Topic type: ${debugData.selectedTopic.type}\n`;
            debugInfo += `Selected Topic is object: ${debugData.selectedTopic.isObject}\n`;
            debugInfo += `Selected Topic name: ${debugData.selectedTopic.topicName}\n\n`;
            
            debugInfo += `Trending Topics count: ${debugData.trendingTopics.count}\n\n`;
            
            debugInfo += `Completed Steps: ${debugData.completedSteps.join(', ')}\n`;
            debugInfo += `Current Step: ${debugData.currentStep}\n\n`;
            
            debugInfo += `UI Dropdown Value: ${debugData.uiState.selectedTopicDropdownValue}\n`;
            debugInfo += `UI Dropdown Text: ${debugData.uiState.selectedTopicDropdownText}\n\n`;
            
            debugInfo += `CHECK CONSOLE for full data objects that you can copy/paste!`;
            
            alert(debugInfo);
        }

        function fixSelectedTopic() {
            console.log('\n🔧 Manual fix for selectedTopic...');
            
            // Check if selectedTopic is corrupted (string or empty)
            if (typeof workflowData.selectedTopic === 'string') {
                if (workflowData.selectedTopic === '') {
                    console.log('❌ selectedTopic is empty string, checking dropdown');
                    
                    // Try to get from dropdown
                    const select = document.getElementById('selectedTopic');
                    const dropdownValue = select ? select.value : '';
                    
                    if (dropdownValue && workflowData.trendingTopics) {
                        const topicIndex = parseInt(dropdownValue);
                        if (!isNaN(topicIndex) && workflowData.trendingTopics[topicIndex]) {
                            const fixedTopic = workflowData.trendingTopics[topicIndex];
                            workflowData.selectedTopic = fixedTopic;
                            displaySelectedTopicDetails(fixedTopic);
                            
                            // Save the fix
                            localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                            
                            console.log('✅ Fixed selectedTopic from dropdown:', fixedTopic);
                            alert(`✅ Fixed! Selected topic is now: "${fixedTopic.topic}"`);
                            return;
                        }
                    }
                    
                    // If no dropdown value, try to restore "Platform Engineering" from trending topics
                    if (workflowData.trendingTopics) {
                        const platformTopic = workflowData.trendingTopics.find(t => 
                            t.topic && t.topic.includes('Platform Engineering')
                        );
                        if (platformTopic) {
                            workflowData.selectedTopic = platformTopic;
                            
                            // Update dropdown
                            const topicIndex = workflowData.trendingTopics.indexOf(platformTopic);
                            if (select) {
                                select.value = topicIndex;
                                displaySelectedTopicDetails(platformTopic);
                            }
                            
                            // Save the fix
                            localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                            
                            console.log('✅ Auto-selected Platform Engineering topic:', platformTopic);
                            alert(`✅ Fixed! Auto-selected: "${platformTopic.topic}"`);
                            return;
                        }
                    }
                    
                    alert('❌ Cannot fix: Please manually select a topic from the dropdown first');
                    
                } else {
                    // Try to parse as index
                    const topicIndex = parseInt(workflowData.selectedTopic);
                    console.log('🔍 Found string selectedTopic:', workflowData.selectedTopic, 'parsing as index:', topicIndex);
                    
                    if (!isNaN(topicIndex) && workflowData.trendingTopics && workflowData.trendingTopics[topicIndex]) {
                        const fixedTopic = workflowData.trendingTopics[topicIndex];
                        workflowData.selectedTopic = fixedTopic;
                        
                        // Update the dropdown
                        const select = document.getElementById('selectedTopic');
                        if (select) {
                            select.value = topicIndex;
                            displaySelectedTopicDetails(fixedTopic);
                        }
                        
                        // Save the fix
                        localStorage.setItem('blogWorkflowData', JSON.stringify(workflowData));
                        
                        console.log('✅ Fixed selectedTopic:', fixedTopic);
                        alert(`✅ Fixed! Selected topic is now: "${fixedTopic.topic}"`);
                    } else {
                        console.log('❌ Cannot parse topic index or invalid index');
                        alert('❌ Cannot fix: Invalid topic index');
                    }
                }
            } else if (typeof workflowData.selectedTopic === 'object' && workflowData.selectedTopic.topic) {
                console.log('✅ selectedTopic is already a valid object');
                alert(`✅ selectedTopic is already correct: "${workflowData.selectedTopic.topic}"`);
            } else {
                console.log('❌ selectedTopic is in unknown state:', workflowData.selectedTopic);
                alert('❌ Cannot fix: selectedTopic is in unknown state');
            }
        }

        function resetWorkflow() {
            if (confirm('Are you sure you want to reset the entire workflow? This will clear all data.')) {
                localStorage.removeItem('blogWorkflowData');
                location.reload();
            }
        }
    </script>
</body>
</html>